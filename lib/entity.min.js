/* EntityJS v0.2 http://entityjs.com | License http://entityjs.com/license */
re=function(selector){return new re.query(selector);};re.version="0.2";re._e=[];re._c={};re.ready=function(r){re.ready.c.push(r);window.onload=function(){for(var k in re.ready.c){re.ready.c[k].call(re);}};};re.ready.c=[];re.$=function(s){return re.$.c[s]=re.$.c[s]||(s.charAt(0)=='#')?document.getElementById(s.substr(1)):document.getElementsByTagName(s);};re.$.c={};re.$new=function(n){return document.createElement(n);};re.listener=function(t,c){if(window.addEventListener){window.addEventListener(t,c,true);}else{document.attachEvent('on'+t,c);}};if(!Array.prototype.indexOf){Array.prototype.indexOf=function(o){for(var i=0;i<this.length;i++){if(this[i]==o){return i;}}
return-1;}}
var __z=function(n,r){this._checkFinal();if(!this[n]){this[n]=[];}
if(typeof r=='string'){this[n]=this[n].concat(r.split(' '));}else{this[n]=this[n].concat(r);}
return this;};re.comp=re.c=function(title){if(!re._c[title]){re._c[title]=new re.comp.init(title);}
return re._c[title];};re.comp.init=function(name){this.name=name;this._re_signals={};this._re_inherits={};this._re_defines={};this._re_final=false;};re.comp.init.prototype={_checkFinal:function(){if(this._re_final){throw this.name+' is final.';}},global:function(obj,value){this._checkFinal();if(arguments.length==1){for(var type in obj){this[type]=obj[type];}}else{this[obj]=value;}
return this;},require:function(r){return __z.call(this,'_re_requires',r);},assert:function(r){return __z.call(this,'_re_asserts',r);},implement:function(r){return __z.call(this,'_re_implments',r);},alias:function(s){this._checkFinal();var p=s.split(' ');if(p.length>1){for(var i in p){this.alias(p[i]);}
return this;}
if(s.charAt(0)=='-'){if(re._c[s.substr(1)]==this){delete re._c[s.substr(1)];}}else{re._c[s]=this;}
return this;},signal:function(string,method){this._checkFinal();return re.entity.init.prototype.signal.call(this,string,method);},inherit:function(d,value){this._checkFinal();if(arguments.length==1){for(var k in d){this._re_inherits[k]=d[k];}}else{this._re_inherits[d]=value;}
return this;},namespace:function(obj,value){this._checkFinal();var name=this.name+'_';if(arguments.length==1){for(var k in obj){this._re_defines[name+k]=obj[k];}}else{this._re_defines[name+obj]=value;}
return this;},define:function(d,value){this._checkFinal();if(!this._re_defines){this._re_defines={};}
if(arguments.length==1){for(var k in d){this._re_defines[k]=d[k];}}else{this._re_defines[d]=value;}
return this;},init:function(method){this._checkFinal();this._re_init=method;return this;},dispose:function(method){this._checkFinal();this._re_dispose=method;return this;},lock:function(){this._checkFinal();this._re_final=true;return this;},run:function(method){this._checkFinal();method.call(this);return this;}};(function(re){var q=function(c,count){if(!count){return new re.entity.init(c);}
var q=re();for(var i=0;i<count;i++){q._e.push(re.e(c));}
return q;}
q.id=0;var e=function(c){c=c||'';this._re_comps=[];this._re_signals={};q.id++;this.id=q.id+'';re._e.push(this);this.comp(c);}
var p=e.prototype;p.id='';p.comp=function(com){this._re_comp(com);if(this._re_interface){for(var i in this._re_interface){if(!this.hasOwnProperty(this._re_interface[i])){throw'implementation: '+this._re_interface[i]+' missing';}}}
if(this._re_asserts){for(var t in this._re_asserts){if(this._re_comps.indexOf(c._re_asserts[t])!=-1){throw'assert: '+c.name+' cannot be coupled with '+c._re_asserts[t];}}}
return this;}
p._re_comp=function(com){if(!com||com==''||com==' ')return this;var pieces;if(typeof com=='object'){pieces=com;com=com[0];}else{pieces=com.split(' ');}
if(pieces.length>1){for(var k in pieces){this._re_comp(pieces[k]);}
return this;}
var c;if(com.charAt(0)=='-'){com=com.substr(1);c=re._c[com];if(!this.has(com))return this;this._re_comps.splice(this._re_comps.indexOf(com),1);if(c){if(c._re_dispose){c._re_dispose.call(this,c);}
c.signal('dispose',this);}}else{var vals=com.split(':');com=vals[0];c=re._c[com];vals[0]=c;if(this.has(com))return this;this._re_comps.push(com);if(c){this._re_comp(c._re_requires);if(c._re_implements){if(!this._re_implements){this._re_implements=[];}
this._re_implements=this._re_implements.concat(c._re_implements);}
if(c._re_asserts){if(!this._re_asserts){this._re_asserts=[];}
this._re_asserts=this._re_asserts.concat(c._re_asserts);}
if(c._re_inherits){this.inherit(c._re_inherits);}
if(c._re_defines){this.define(c._re_defines);}
if(c._re_init){c._re_init.apply(this,vals);}
c.signal('init',this);}}
return this;}
p.getComps=function(){return this._re_comps.slice();}
p.clone=function(count){return re.e(this._re_comps,count);}
p.parent=function(comp,method){var a=Array.prototype.slice.call(arguments,2);if(comp==''){re.e.init[method].apply(this,a);}
var c=re._c[comp];if(c._re_defines[method]){return c._re_defines[method].apply(this,a);}
if(c._re_inherits[method]){return c._re_inherits[method].apply(this,a);}
return this;}
p.has=function(comp){if(typeof comp=='string'){comp=re.query._toObj(comp);}
comp.comp=comp.comp||[];comp.id=comp.id||'';comp.signal=comp.signal||[];comp.not=comp.not||[];for(p=0;p<comp.comp.length;p++){if(this._re_comps.indexOf(comp.comp[p])==-1){return false;}}
for(p=0;p<comp.not.length;p++){if(this._re_comps.indexOf(comp.not[p])!=-1){return false;}}
var s;for(p=0;p<comp.signal.length;p++){s=comp.signal[p];if(!this._re_signals[s]||this._re_signals[s].length==0){return false;}}
if(comp.id!=''&&this.id!=comp.id){return false;}
return true;}
p.signal=function(type,method,con){if(arguments.length==0||type==undefined){throw'Signal error Type variable undefined';}
var c;if(typeof type=='string'){c=type.split(' ');if(c.length>1){var args=Array.prototype.slice.call(arguments,1);for(var k in c){args.unshift(c[k]);this.signal.apply(this,args);args.shift();}
return this;}}
if(typeof type=='object'){for(var k in type){this.signal(k,type[k]);}}else if(type.charAt(0)=='-'){type=type.substr(1);if(type=='*'){this._re_signals={};}else if(method){if(typeof method=='function'){for(var k in this._re_signals[type]){if(this._re_signals[type][k].f==method){this._re_signals[type].splice(k,1);}}}else{throw'Cannot remove signal method '+method;}}else{this._re_signals[type]=[];}}else if(arguments.length>=2&&method&&typeof method=='function'){var obj={f:method};if(typeof con=='object'){obj.c=con;}
if(type.charAt(0)=='!'){obj.once=true;type=type.substr(1);}
if(!this._re_signals[type]){this._re_signals[type]=[];}
this._re_signals[type].push(obj);}else{if(!this._re_signals[type]){return this;}
var b;for(var i=0;i<this._re_signals[type].length;i++){b=this._re_signals[type];b[i].f.apply((b[i].c)?b[i].c:this,Array.prototype.slice.call(arguments,1));if(b.once){b.splice(i,1);}
if(type!='*'&&this._re_signals['*']){this.signal('*');}}}
return this;}
p.define=function(obj,value){if(typeof obj=='object'){for(var key in obj){if(!obj.hasOwnProperty(key))continue;this.define(key,obj[key]);}}else{this[obj]=value;}
return this;}
p.inherit=function(obj,value){if(typeof obj=='object'){for(var key in obj){if(!obj.hasOwnProperty(key))continue;this.inherit(key,obj[key]);}}else{if(!this.hasOwnProperty(obj)||typeof this[obj]!=typeof value){this[obj]=value;}}
return this;}
p.dispose=function(){re._e.splice(re._e.indexOf(this),1);for(var i in this._re_comps){var k=re.c(this._re_comps[i]);if(k._re_dispose){k._re_dispose.call(this,k);}}
this.signal('dispose');return this;}
re.entity=re.e=q;re.entity.init=e;}(re));(function(re){var b=function(assets){return new re.load.init(assets);}
b.path="";b.imageExt='img';b.soundExt='sfx';b.images=['gif','jpg','jpeg','png'];b.sounds=['wav','mp3','aac','ogg'];var l=function(assets){if(typeof assets=='string'){this.assets=assets.split(' ');}else{this.assets=assets;}
var a;for(var i=0;i<this.assets.length;i++){this.total++;a=this.assets[i];var j=a.lastIndexOf('.')+1;var ext=a.substr(j).toLowerCase();var d=a.lastIndexOf('/');if(d!=-1){a=a.substr(d+1,a.length);}
var n=a.substr(0,j);if(re.load.images.indexOf(ext)!=-1){this._loadImg(a,n);}else if(re.load.sounds.indexOf(ext)!=-1){if(!re.support||re.support(ext)){this._loadSound(a,n);}}}
return this;}
var p=l.prototype;p.current=0;p.total=0;p._loadImg=function(a,n){var that=this;var img=new Image();re.c(a).alias(n+re.load.imgExt).global({image:img}).define({image:img});img.onload=function(){that.current++;if(that._p){that._p.call(that,that.current,that.total,a);}
if(that.current>=that.total){if(that._s){that._s.call(that,that.assets);}}};img.onerror=function(){if(that._e){that._e.call(that,a);}};img.src=re.load.path+a
return this;}
p._loadSound=function(a,n){var that=this;var s=new Audio(re.load.path+a);s.preload="auto";s.load();re.c(a).alias(n+re.load.soundExt).global({sound:s}).define({sound:s});s.addEventListener('canplaythrough',function(){that.current++;if(that._p){that._p.call(that,that.current,that.total,a);}
if(that.current>=that.total){if(that._s){that._s.call(that,that.assets);}}},false);s.addEventListener('error',function(){if(that._e){that._e.call(that,a);}},false);}
p.progress=function(m){this._p=m;return this;}
p.complete=function(m){this._s=m;return this;}
p.error=function(m){this._e=m;return this;}
re.load=b;re.load.init=l;}(re));(function(re){var q=function(selector){this._e=[];if(selector){this.query(selector);}}
q._toObj=function(query){if(q.c[query]){return q.c[query];}
var temp=query.split(' ');var comps=[];var signals=[];var minus=[];var id='';var fl;var val;for(var j=0;j<temp.length;j++){fl=temp[j].charAt(0);val=temp[j].substr(1);if(fl=='^'){signals.push(val);}else if(fl=='-'){minus.push(val);}else if(fl=='#'){id=val;}else{comps.push(temp[j]);}}
var comp={comp:comps,signal:signals,not:minus,id:id};q.c[query]=comp;return comp;}
q.c={};var p=q.prototype;p.query=function(select){select=select||'';var i=0;if(typeof select=='string'){if(select=='*'){this._e=re._e.slice();return this;}
var obj=q._toObj(select);var en;main:for(;i<re._e.length;i++){en=re._e[i];if(en.has(obj)){this._e.push(en);}}}else if(typeof select=='function'){for(;i<re._e.length;i++){if(select.call(re._e[i],i)){this._e.push(re._e[i]);}}}
return this;}
p.toArray=function(){return this._e.slice();}
p.method=function(m){var b=Array.prototype.slice.call(arguments,1);this.each(function(){this[m].apply(this,b);});return this;}
p.each=function(method){var l=this._e.length;for(var i=0;i<l;i++){if(method.call(this._e[i],i,l)==false)break;}
return this;}
p.map=function(w,method){var x=0;var y=0;for(var i=0;i<this._e.length;i++){if(method.call(this._e[i],x,y)==false)break;x++;if(x==w){x=0;y++;}}}
p.compArray=function(){var l=[];this.each(function(){l.concat(this.compArray());});return l;}
p.random=function(){return this._e[Math.random()*this._e.length];}
p.pluck=function(value){var t=[];var k=value.split(' ');this.each(function(){var o={};for(var p in k){if(k.hasOwnProperty(p)){o[k[p]]=this[k[p]];}}
t.push(o);});return t;}
p.define=function(obj,value){this.each(function(){this.define(obj,value);});return this;}
p.inherit=function(obj,value){this.each(function(){this.inherit(obj,value);});return this;}
p.comp=function(c){this.each(function(ref){this.comp(c);});return this;}
p.signal=function(type,method){var p=arguments;this.each(function(ref){this.signal.apply(this,p);});return this;}
p.length=function(){return this._e.length;}
p.filter=function(method){var q=re();var that=this;this.each(function(i){if(method.call(this,i)){q.push(this);}});return q;}
p.has=function(comp){for(var i=0;i<this._e.length;i++){if(!this._e.has(comp)){return false;}}
return this;}
p.dispose=function(){this.each(function(){this.dispose();});return this;}
p.get=function(index){return this._e[index];}
p.put=function(entity){this._e.push(entity);return this;}
re.query=q;}(re));re.c('system').define({clearColor:'#f9f9f9',running:false,clear:function(color){if(color){this.context.fillStyle=color;this.context.fillRect(0,0,this.size.x,this.size.y);}else{this.context.clearRect(0,0,this.size.x,this.size.y);}
return this;},start:function(){if(!this.running){this.running=true;var that=this;(function mainLoop(){if(that.running){that.system_loop.call(that);that.requestAnimationFrame(mainLoop,that.canvas);}})();}
return this;},loop:function(m){this.system_loop=m;return this;},stop:function(){if(this.running){this.running=false;}
return this;},init:function(canvasId,screen){this.comp('polyfill ticker');this.canvas=re.$(canvasId);this.context=this.canvas.getContext('2d');this.size.x=this.canvas.width;this.size.y=this.canvas.height;screen=screen||re.screen;if(screen){screen.size.x=this.size.x;screen.size.y=this.size.y;screen.reg.x=this.size.x*0.5;screen.reg.y=this.size.y*0.5;}
return this;},system_loop:function(){re._c.update.update.call(re._c.update,this,this.tick(),this.time);this.clear(this.clearColor);re._c.draw.draw.call(re._c.draw,this,this.context);}}).init(function(c){this.size={x:0,y:0};}).run(function(){re.system=re.sys=re.e('system');});re.c('draw').global({listeners:[],draw:function(s,c){var l=this.listeners;for(var k=0,le=l.length,b;k<le;++k){b=l[k];if(b&&b.sys==s&&b.drawing){b.draw_render(c);}}}}).init(function(c){c.listeners.push(this);this.scale={x:1,y:1};this.reg={x:1,y:1};this.screen=re.screen;}).dispose(function(c){c.listeners.splice(c.listeners.indexOf(this),1);}).inherit({sys:re.sys,drawing:true,rotation:0,alpha:1}).inherit({cache:function(){if(!this.image)return this;this.clearCache();var c=re.$new('canvas');var s=Math.max(this.image.width,this.image.height);c.width=s;c.height=s;this.draw_render(c.getContext('2d'));this.canvasCache=c;return this;},clearCache:function(){this.canvasCache=null;},drawFirst:function(){var l=re.c('draw').listeners;l.splice(l.indexOf(this),1);l.unshift(this);return this;},drawLast:function(){var l=re.c('draw').listeners;l.splice(l.indexOf(this),1);l.push(this);return this;},drawAfter:function(en){var l=re.c('draw').listeners;var him=l.indexOf(en);var me=l.indexOf(this);if(him>me){var t=l[him];l[him]=l[me];l[me]=t;}
return this;},drawBefore:function(en){var l=re.c('draw').listeners;var him=l.indexOf(en);var me=l.indexOf(this);if(him<me){var t=l[him];l[him]=l[me];l[me]=t;}
return this;},getScreenX:function(){var x=this.pos.x;if(this.screen)x-=this.screen.pos.x;return x;},getScreenY:function(){var y=this.pos.y;if(this.screen)y-=this.screen.pos.y;return y;}}).namespace({render:function(c){this.draw_before(c);this.signal('draw',c);this.draw_after(c);},before:function(c){c.save();if(this.alpha!=1)
c.globalAlpha=this.alpha;c.translate(this.getScreenX(),this.getScreenY());if(this.rotation!=0)
c.rotate(this.rotation*Math.PI/180);if(this.scale.x!=1||this.scale.y!=1)
c.scale(this.scale.x,this.scale.y);},after:function(c){c.restore();}});re.c('ticker').inherit({time:0,minStep:0.05}).init(function(){this.lastTime=Date.now();}).define({tick:function(){var wall=Date.now();var delta=(wall-this.lastTime)/1000;this.lastTime=wall;var timeDelta=Math.min(delta,this.minStep);this.time+=timeDelta;return timeDelta;}});re.c('update').global({listeners:[],update:function(s,tick,time){var l=this.listeners;for(var k=0,le=l.length,b;k<le;++k){b=l[k];if(b&&b.sys==s&&b.updating){b.signal('update',tick,time);}}}}).inherit({updating:true,sys:re.sys}).inherit({updateFirst:function(){var l=re.c('update').listeners;l.splice(l.indexOf(this),1);l.unshift(this);return this;},updateLast:function(){var l=re.c('update').listeners;l.splice(l.indexOf(this),1);l.push(l);return this;},updateAfter:function(e){var l=re.c('update').listeners;var him=l.indexOf(e);var me=l.indexOf(this);if(him>me){var t=l[him];l[him]=l[me];l[me]=t;}
return this;},updateBefore:function(e){var l=re.c('update').listeners;var him=l.indexOf(e);var me=l.indexOf(this);if(him<me){var t=l[him];l[him]=l[me];l[me]=t;}
return this;}}).init(function(){re.c('update').listeners.push(this);}).dispose(function(){re.c('update').listeners.splice(re.c('update').listeners.indexOf(this),1);});re.c('bar').require('draw').init(function(){this.pos={x:0,y:0};this.size={x:0,y:40,max:{x:150,y:40}};this.signal('draw',this.bar_draw);}).define({botColor:'#82d5f4',topColor:'#25acdf'}).namespace({draw:function(c){c.fillStyle=this.botColor;c.fillRect(-this.reg.x,-this.reg.y,this.size.max.x,this.size.max.y);c.fillStyle=this.topColor;c.fillRect(-this.reg.x,-this.reg.y,this.size.x,this.size.y);}});re.c('bitfont').require('point draw').inherit({text:'',charOffset:32}).namespace({draw:function(context){if(this.text.length!=0&&this.image&&(!this.screen||this.screen.touches(this.pos.x-this.reg.x,this.pos.y-this.reg.y,this.size.x,this.size.y))){var slot=0,charWidth,code,charPos;for(var i=0,l=this.text.length;i<l;++i){code=this.text.charCodeAt(i)-this.charOffset;charWidth=this.charWidths[code];if(!this.charCache[code]){charPos=0;for(var p=0;p<code;++p){charPos+=this.charWidths[p]+1;}
this.charCache[code]=charPos;}
context.drawImage(this.image,this.charCache[code],0,charWidth,this.image.height,-this.reg.x+slot,-this.reg.y,charWidth,this.image.height);slot+=charWidth;}
this.size.x=slot;this.size.y=this.image.height;}}}).define({updateSize:function(){var t=0;for(var p=0;p<this.text.length;p++){t+=this.charWidths[p];}
this.size.x=t;if(this.image){this.size.y=this.image.height;}else{this.size.y=0;}
return this;},setText:function(text){this.text=text;this.updateSize();return this;}}).init(function(){this.size={x:0,y:0};this.reg={x:0,y:0};if(!this.charCache){this.charCache={};}
this.signal('draw',this.bitfont_draw);}).dispose(function(){this.signal('-draw',this.bitfont_draw);});re.comp('bitmap').require('point draw').init(function(){if(!this.size)
this.size={x:0,y:0};if(this.image){this.reg.x=this.image.width*0.5;this.reg.y=this.image.height*0.5;this.size.x=this.image.width;this.size.y=this.image.height;}
this.signal('draw',this.bitmap_draw);}).dispose(function(){this.signal('-draw',this.bitmap_draw);}).namespace({draw:function(c){if(this.image&&(!this.screen||this.screen.touches(this.pos.x-this.reg.x,this.pos.y-this.reg.y,this.image.width,this.image.height))){c.drawImage((this.canvasCache)?this.canvasCache:this.image,-this.reg.x,-this.reg.y,this.image.width,this.image.height);}}});re.c('font').require('draw point').inherit({font:"14px sans-serif",textColor:'#000000',textAlign:'',text:''}).namespace({draw:function(context){if(this.text.length!=0){context.font=this.font;context.fillStyle=this.textColor;context.fillText(this.text,-this.reg.x,-this.reg.y);}}}).init(function(){this.signal('draw',this.font_draw);});re.c('sprimate').require('sprite update').namespace({animating:'',stop:function(){if(this.animating()){this.sprimate_animating='';this.signal('sprimated');this.frame.x=this.sprimate_old.x;this.frame.y=this.sprimate_old.y;this.signal('-update',this.sprimate_update);}
return this;},update:function(t){var c=this.sprimate_reel;this.sprimate_tick++;if(this.sprimate_tick>=c.duration){this.sprimate_tick=0;if(this.sprimate_frame==this.sprimate_reel.frames.length){if(c.loops==0||--this.sprimate_loops>=1){this.sprimate_frame=0;}else{this.sprimate_stop();return;}}
this.setFrameId(c.frames[this.sprimate_frame]);this.sprimate_frame++;}}}).init(function(){this.sprimate_reels={};this.sprimate_old={};this.sprimate_reel={};}).define({sprimate:function(id,loops,duration,frames){if(arguments.length==0){return this.sprimate_stop();}
if(id==this.sprimate_animating)return;if(typeof frames=='string')frames=frames.split(' ');if(!this.sprimate_reels[id]){this.sprimate_reels[id]={frames:frames,duration:duration,loops:loops};}else{if(!this.sprimate_reels[id]){return this;}
var r=this.sprimate_reels[id];var c=this.sprimate_reel;c.loops=(isNaN(loops))?r.loops:loops;c.duration=(isNaN(duration))?r.duration:duration;c.frames=(typeof frames=='object')?frames:r.frames;this.sprimate_loops=c.loops;c.duration=Math.ceil(c.duration/c.frames.length);this.sprimate_old.x=this.frame.x;this.sprimate_old.y=this.frame.y;this.sprimate_mpf=1000/c.frames.length;this.sprimate_frame=0;this.sprimate_tick=0;this.setFrameId(c.frames[this.sprimate_frame++]);if(!this.animating()){this.signal('update',this.sprimate_update);}
this.sprimate_animating=id;}
return this;},animating:function(id){if(id){return this.sprimate_animating==id;}
return this.sprimate_animating!='';}});re.c('sprite').require('point draw bisect').init(function(){if(!this.frame){this.frame={x:0,y:0};}
if(!this.frame.size){this.frame.size={x:40,y:40};}
this.signal('draw',this.sprite_draw);}).dispose(function(){this.signal('-draw',this.sprite_draw);}).define({setFrameId:function(id){this.frame.x=this.biToXt(id,this.image.width,this.frame.size.x);this.frame.y=this.biToYt(id,this.image.width,this.frame.size.y);return this;},getFrameId:function(){return this.toBi(this.frame.y,this.frame.x,this.image.width);}}).namespace({draw:function(c){if(this.image&&(!this.screen||this.screen.touches(this.pos.x-this.reg.x,this.pos.y-this.reg.y,this.frame.size.x,this.frame.size.y))){c.drawImage((this.canvasCache)?this.canvasCache:this.image,this.frame.x*this.frame.size.x,this.frame.y*this.frame.size.y,this.frame.size.x,this.frame.size.y,-this.reg.x,-this.reg.y,this.frame.size.x,this.frame.size.y);}
return this;}});re.c('keyboard').global({listeners:[],keyCodes:{65:'a',66:'b',67:'c',68:'d',69:'e',70:'f',71:'g',72:'h',73:'i',74:'j',75:'k',76:'l',77:'m',78:'n',79:'o',80:'p',81:'q',82:'r',83:'s',84:'t',85:'u',86:'v',87:'w',88:'x',89:'y',90:'z',48:'0',49:'1',50:'2',51:'3',52:'4',53:'5',54:'6',55:'7',56:'8',57:'9',112:'f1',113:'f2',114:'f3',115:'f4',116:'f5',117:'f6',118:'f7',119:'f8',120:'f9',121:'f10',122:'f11',123:'f12',16:'shift',17:'ctrl',18:'alt',24:'cmd',255:'fn',8:'backspace',13:'enter',32:'space',27:'esc',9:'tab',20:'capslock',91:'windows',46:'delete',36:'home',35:'end',33:'pageup',34:'pagedown',37:'left',38:'up',39:'right',40:'down',96:'`',45:'-',187:'=',219:'[',221:']',220:'\\',59:';',222:"'",188:',',190:'.',191:'/'},keyboardEvent:function(e){var that=re.c('keyboard');var c=e.keyCode||e.which;var key=that.keyCodes[c];if(re.c('pressed').preventDefault[key]){if(e.preventDefault)
e.preventDefault();else
e.returnValue=false;}
if(re.c('pressed')._pressed){re.c('pressed')._pressed[key]=(e.type=='keydown');}
for(var k=0;k<that.listeners.length;k++){that.listeners[k].signal(e.type+' '+e.type+':'+key,key,e);}},active:false,initKeyboard:function(){if(!this.active){this.active=true;re.listener('keydown',this.keyboardEvent,false);re.listener('keyup',this.keyboardEvent,false);}}}).init(function(c){c.initKeyboard();c.listeners.push(this);}).dispose(function(c){c.listeners.splice(c.listeners.indexOf(this),1);});re.c('mouse').global({listeners:[],mouseAction:function(e){var b;if(e.which==null){if(e.button<2){b='left';}else if(e.button==4){b='middle';}else{b='right';}}else{if(e.which<2){b='left';}else if(e.which==2){b='middle';}else{b='right';}}
b='mouse:'+b;if(re.c('pressed')._pressed){re.c('pressed')._pressed[b]=(e.type=='mousedown');}
if(re.c('pressed').preventDefault){if(re.c('pressed').preventDefault[b]){if(e.preventDefault)
e.preventDefault();else
e.returnValue=false;}}
re.c('mouse').mouseEvent(e);},mouseEvent:function(e){var x;var y;if(e.pageX||e.pageY){x=e.pageX;y=e.pageY;}else{x=e.clientX+document.body.scrollLeft+document.documentElement.scrollLeft;y=e.clientY+document.body.scrollTop+document.documentElement.scrollTop;}
if(re.sys.canvas){x-=re.sys.canvas.offsetLeft;y-=re.sys.canvas.offsetTop;}
if(x<0||y<0||y>re.sys.size.y||x>re.sys.size.x){return;}
var that=re.c('mouse');for(var i=0;i<that.listeners.length;i++){that.listeners[i].signal(e.type,x,y,e);}},active:false,initMouse:function(){if(!this.active){this.active=true;re.listener('mousedown',this.mouseAction,false);re.listener('mouseup',this.mouseAction,false);re.listener('mousemove',this.mouseEvent,false);re.listener('click',this.mouseEvent,false);re.listener('dblclick',this.mouseEvent,false);re.listener('contextmenu',this.mouseEvent,false);}}}).init(function(c){c.initMouse();c.listeners.push(this);}).dispose(function(c){c.listeners.splice(c.listeners.indexOf(this),1);});re.c('pressed').global({_pressed:{},preventDefault:{}}).define({pressed:function(key){var that=re.c('pressed');var c=typeof key=='object';if(arguments.length>1||c){if(c)c=key
else c=arguments;for(var i=0;i<c.length;i++){if(that._pressed[c[i]]){return true;}}}
return that._pressed[key];},preventDefault:function(key){var p=key.split(' ');if(p.length>1){for(var k in p){this.preventDefault(p[k]);}
return this;}
re.c('pressed').preventDefault[key]=true;return this;}}).init(function(){re._c.keyboard.initKeyboard();re._c.mouse.initMouse();});re.c('bind').require('point update').namespace({update:function(){if(this.pos.x<this.bind.min.x){this.pos.x=this.bind.min.x;}else if(this.pos.x>this.bind.max.x){this.pos.x=this.bind.max.x;}
if(this.pos.y<this.bind.min.y){this.pos.y=this.bind.min.y;}else if(this.pos.y>this.bind.max.y){this.pos.y=this.bind.max.y;}}}).init(function(){this.bind={min:{x:0,y:0},max:{x:10,y:10}};this.signal('update',this.bind_update);}).dispose(function(){this.signal('-update',this.bind_update);});re.c('bisect').define({biToX:function(bi,width,size){return this.biToXt(bi,width)*size;},biToY:function(bi,width,size){return this.biToYt(bi,width)*size;},biToXt:function(bi,width,size){return Math.floor(bi%(width/size));},biToYt:function(bi,width,size){return Math.floor((bi*size)/(width-0.1));},toBi:function(xt,yt,wt){return xt+(yt*wt);}});re.c('drag').require('point').init(function(){this.drag_pos={x:0,y:0};}).define({anchorDrag:function(x,y){this.drag_pos.x=x;this.drag_pos.y=y;},updateDrag:function(x,y){this.pos.x+=x-this.drag_pos.x;this.pos.y+=y-this.drag_pos.y;this.drag_pos.x=x;this.drag_pos.y=y;}});re.c('group').require('point').define({getScreenX:function(){var x=this.pos.x;if(this.group)x+=this.group.pos.x;if(this.screen)x+=this.screen.pos.x;return x;},getScreenY:function(){var y=this.pos.y;if(this.group)y+=this.group.pos.y;if(this.screen)y+=this.screen.pos.y;return y;},getGroupX:function(){var x=this.pos.x;if(this.group){x+=this.group.pos.x;}
return x;},getGroupY:function(){var y=this.pos.y;if(this.group){y+=this.group.pos.y;}
return y;},setGroupX:function(x){},setGroupY:function(y){}});re.c('hitmap').require('arraymap').define({hitValue:1,checkAxisX:function(value,x,y,vx,vy){return value==this.hitValue;},checkAxisY:function(value,x,y,vx,vy){return value==this.hitValue;},checkHit:function(pos,vel,size){if(arguments.length==1){var vel=pos.vel;var size=pos.size;pos=pos.pos;}
var res={pos:{x:pos.x,y:pos.y},tile:{}};var step=~~(Math.max(Math.abs(vel.x),Math.abs(vel.y))/((re.tile.size.x+re.tile.size.y)*0.5)+0.5);if(step>1){var sx=vel.x/step;var sy=vel.y/step;for(var i=0;i<step&&(sx||sy);i++){this.hitmap_step(res,pos.x,pos.y,sx,sy,size.x,size.y);if(res.x){sx=0;}
if(res.y){sy=0;}}}else{this.hitmap_step(res,pos.x,pos.y,vel.x,vel.y,size.x,size.y);}
return res;}}).namespace({step:function(res,x,y,vx,vy,width,height){res.pos.x+=vx;res.pos.y+=vy;var t,ty,tx;if(vx){t=re.tile.size.x;var offsetx=(vx>0?width:0);var firsty=Math.floor(y/t);var lasty=Math.ceil((y+height)/t);tx=Math.floor((x+vx+offsetx)/t);var offx=(vx<0?t:0);if(tx>=0&&tx<this.size.x&&lasty>=0&&firsty<this.size.y){for(ty=firsty;ty<lasty;ty++){if(this.map[ty]){this.signal('hit',this.map[ty][tx],tx,ty);if(this.checkAxisX(this.map[ty][tx],x,y,vx,vy)){res.x=true;res.pos.x=tx*t+offx-offsetx;res.tile.x=tx*t;res.tile.y=ty*t;break;}}}}}
if(vy){t=re.tile.size.y;var offsety=(vy>0?height:0);var firstx=Math.floor(res.pos.x/t);var lastx=Math.ceil((res.pos.x+width)/t);ty=Math.floor((y+vy+offsety)/t);var offy=(vy<0?t:0);if(ty>=0&&ty<this.size.y&&lastx>=0&&firstx<this.size.x){for(tx=firstx;tx<lastx;tx++){if(this.map[ty]){this.signal('hit',this.map[ty][tx],tx,ty);if(this.checkAxisY(this.map[ty][tx],x,y,vx,vy)){res.y=true;res.pos.y=ty*t+offy-offsety;res.tile.x=tx*t;res.tile.y=ty*t;break;}}}}}}});re.physics=re.c('physics').require('point update').global({gra:{x:0,y:0},minVel:0.01}).init(function(c){if(!this.has('size')||!this.has('radius')){this.comp('size');}
this.vel={x:0,y:0,max:{x:100,y:100}};this.fri={x:0.9,y:0.4};this.acc={x:0,y:0};this.res={x:0,y:0};this.mas={x:1,y:1};this.signal('update',this.physics_update);this.hitmap=c.hitmap;this.gra={x:c.gra.x,y:c.gra.y};}).dispose(function(){this.signal('-update',this.physics_update);}).namespace({update:function(t){this.vel.x=this.force(this.vel.x,this.acc.x,this.fri.x,this.gra.x,this.mas.x,t,this.vel.max.x);this.vel.y=this.force(this.vel.y,this.acc.y,this.fri.y,this.gra.y,this.mas.y,t,this.vel.max.y);if(this.hitmap){this.step(this.hitmap.checkHit(this));}else{this.pos.x+=this.vel.x;this.pos.y+=this.vel.y;this.step(this.pos);}}}).define({step:function(pos,hitx,hity,tilex,tiley){if(arguments.length==1){hitx=pos.x;hity=pos.y;if(pos.tile){tilex=pos.tile.x;tiley=pos.tile.y;}
pos=pos.pos;}
this.pos=pos;this.signal('step',hitx,hity,tilex,tiley);if(hitx){this.vel.x=this.forceRes(this.vel.x,this.res.x);}
if(hity){this.vel.y=this.forceRes(this.vel.y,this.res.y);}
if(Math.abs(this.vel.x)<re.physics.minVel){this.vel.x=0;}
if(Math.abs(this.vel.y)<re.physics.minVel){this.vel.y=0;}},forceRes:function(vel,res){return vel*-res;},forceGra:function(gra,mas,tim){return gra*mas*tim;},forceVel:function(vel,acc,fri,tim){return(vel+acc*tim)*fri;},force:function(vel,acc,fri,gra,mas,tim,max){var v=this.forceVel(vel,acc,fri,tim)+this.forceGra(gra,mas,tim);v=Math.min(max,Math.max(-max,v));return v;},isIdle:function(){return(this.vel.y==0&&this.vel.x==0&&this.acc.x==0&&this.acc.y==0);}});re.c('point').init(function(){if(!this.pos)
this.pos={x:0,y:0};}).define({moveTo:function(x,y){if(arguments.length==1){y=x.y;x=x.x;}
this.pos.x=x;this.pos.y=y;return this;},distanceTo:function(x,y){}});re.c('position').require('point').define({centerX:function(o){o=o||0;this.pos.x=Math.floor(re.sys.size.x*0.5-this.size.x*0.5+o);return this;},centerY:function(o){o=o||0;this.pos.y=Math.floor(re.sys.size.y*0.5-this.size.y*0.5+o);return this;},right:function(x){x=x||0;this.pos.x=Math.floor(re.sys.size.x-this.size.x+x);return this;},left:function(x){x=x||0;this.pos.x=Math.floor(x);return this;},top:function(y){y=y||0;this.pos.y=Math.floor(y);return this;},bottom:function(y){y=y||0;this.pos.y=Math.floor(re.sys.size.y-this.size.y+y);return this;}}).init(function(){if(!this.size)
this.size={x:0,y:0};});re.c('radius').require('point').inherit({radius:0}).define({touches:function(targ){},distanceTo:function(xt,yt){}});re.c('screen').require('size point').define({moveTo:function(x,y){if(arguments.length==1){y=x.y;x=x.x;}
this.pos.x=x-this.reg.x;this.pos.y=y-this.reg.y;return this;}}).init(function(){this.reg={x:0,y:0};this.size={x:9,y:9};});re.ready(function(){re.screen=re.e('screen');});re.c('size').require('point').define({touches:function(x,y,w,h){return!(x>this.pos.x+this.size.x||x+w<this.pos.x||y>this.pos.y+this.size.y||y+h<this.pos.y);},distanceTo:function(pos){var kx,ky;kx=pos.x-this.pos.x>>31;ky=pos.y-this.pos.y>>31;return Math.round(((xt-this.pos.x^kx)-kx)+((yt-this.pos.y^ky)-ky));}}).init(function(){if(!this.size)
this.size={x:40,y:40};})
re.tile=re.c('tile').require('point').global({size:{x:40,y:40},roundX:function(x,size){if(arguments.length==1){size=re.tile.size.x;}
return re.tile.pointToXt(x)*size;},roundY:function(y,size){if(arguments.length==1){size=re.tile.size.y;}
return re.tile.pointToYt(y)*size;},xToXt:function(x,size){if(arguments.length==1){size=re.tile.size.x;}
return Math.round((x-size*0.5)/size);},yToYt:function(y,size){if(arguments.length==1){size=re.tile.size.y;}
return Math.round((y-size*0.5)/size);}}).init(function(){this.size=re.tile.size;}).define({tileFromPoint:function(x,y){this.pos.x=re.tile.roundX(x);this.pos.y=re.tile.roundY(y);return this;},tile:function(xt,yt){this.setXt(xt);this.setYt(yt);return this;},setXt:function(value){this.pos.x=Math.floor(value*this.size.x);return this;},getXt:function(){return Math.floor(this.pos.x/this.size.x);},setYt:function(value){this.pos.y=Math.floor(value*this.size.y);return this;},getYt:function(){return Math.floor(this.pos.y/this.size.y);}});re.c('tween').require('update').global({tween:function(obj,time,props){}}).namespace({update:function(t,time){}}).define({tween:function(time,props){this.time=time||5;this.signal('-update',this.tween_update);for(var i in props){if(!props.hasOwnProperty(i))continue;this.tween_props[i]={s:re.sys.time,i:props[i]};}
return this;}}).init(function(){this.tween_props={};});re.tween=re.c('tween').tween;re.c('playlist');re.sound=re.c('sound').global({enabled:true,volume:1}).inherit({volume:1}).define({play:function(loop){if(!this.sound||!re.sound.enabled)return this;var c=this.sound;c.currentTime=0;c.play();if(loop){var l=0;c.addEventListener('ended',function(){if(loop==-1||l>=loop){c.currentTime=0;l++;}},false);}
return this;},resume:function(){this.sound.play();return this;},pause:function(){this.sound.pause();return this;},currentTime:function(){return this.sound.currentTime;},ended:function(){return this.sound.ended;}});re.c('arraymap').define({value:0,set:function(x,y,value){while(y>=this.map.length){var m=new Array(this.map[0]);for(var l in m){m[l]=this.value;}
this.map.push(m);}
while(x>=this.map[this.map.length-1].length){for(var k=0;k<this.map.length;k++){this.map[k].push(this.value);}}
this.size.x=this.map[y].length;this.size.y=this.map.length;this.map[y][x]=value;return this;},within:function(x,y){if(y<0||y>=this.size.y||x<0||x>=this.size.x){return false;}
return true;},get:function(x,y){if(this.within(x,y)){return this.map[y][x];}
return null;},copy:function(a){for(var y=0;y<a.length;y++){for(var x=0;x<a[0].length;x++){this.set(x,y,a[y][x]);}}
return this;}}).init(function(){this.size={x:0,y:0};this.map=[];});re.c('storage').init(function(c,type){this.storage=(type=='session')?sessionStorage:localStorage;}).define({length:function(){return this.storage.length;},key:function(index){return this.storage.key(index);},getItem:function(key){return this.storage.getItem(key);},getJson:function(key){return JSON.parse(this.getItem(key));},setItem:function(key,data){if(typeof data!='number'||typeof data!='string'){data=JSON.stringify(data);}
this.storage.setItem(key,data);return this;},removeItem:function(key){this.storage.removeItem(key);return this;},clear:function(){this.storage.clear();return this;}})
re.log=function(){try{console.log.apply(console,arguments);}catch(e){try{opera.postError.apply(opera,arguments);}catch(e){alert(Array.prototype.join.call(arguments," "));}}};re.c('log').define('log',re.log);re.c('polyfill').define({requestAnimationFrame:function(callback,canvas){return requestAnimFrame(callback,canvas);}}).run(function(){window.requestAnimFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(callback){window.setTimeout(callback,1000/60);};});re.c('random').define({random:function(max,min){switch(arguments.length){case 0:return Math.random();case 1:return Math.random()*max;case 2:return Math.random()*(max-min+1)+min;}},randomInt:function(max,min){return Math.floor(this.random.apply(this,arguments));}}).run(function(){var b=re.e('random');re.random=b.random;re.randomInt=b.randomInt;b.dispose();});re.scene=function(title){var s=re.c('scene');var k=title.split(' ');if(k.length>1){title=k.pop();for(var b in k){arguments.callee.apply(s,arguments);}}
if(title.charAt(0)=='-'){delete s._scenes[title.substr(1)];return s;}else if(s._scenes[title]){var current=arguments.callee.current;var t=s._scenes[current];if(t&&typeof t.scene_exit=='function'){t.scene_exit.call(t,title);}
arguments.callee.current=title;s.curent=title;t=s._scenes[title];if(typeof t.scene_enter=='function'){t.scene_enter.apply(t,Array.prototype.slice.call(arguments,1));}}else{re.e('scene:'+title);}
return s._scenes[title];};re.c('scene').global({_scenes:{}}).init(function(c,title){c._scenes[title]=this;this.sceneName=title;}).dispose(function(c){delete c._scenes[this.sceneName];}).define({enter:function(m){this.scene_enter=m;return this;},exit:function(m){this.scene_exit=m;return this;},scene:function(){return re.scene.apply(this,arguments);}});re.c('sheet').global({sheet:function(map,padX,padY,sizeX,sizeY){var frameWidth=sizeX||re.tile.size.x;var frameHeight=sizeY||re.tile.size.y;if(padX){frameWidth+=padX;}
if(padY){frameHeight+=padY;}
var x;var y;for(var p in map){x=map[p][0]||0;y=map[p][1]||0;re.c(p).require('sprite').define({frame:{x:x,y:y,size:{x:frameWidth,y:frameHeight}},sheet:this.image});}
return this;}}).require('tile').define({sheet:re.sheet});re.sheet=re.c('sheet').sheet;re.c('support').global({support:function(s){var that=re.c('support');if(arguments.length>1){var d;for(var i=0;i<arguments.length;i++){d=arguments[i];if(that.support(d)){return d;}}
return false;}
var k=s.split(' ');var stat=true;for(var j in k){stat=stat&&!!that[k[j]];}
return stat;}}).define({support:function(s){return re.c('support').call(this,s);}}).run(function(){var c=re.c('support');re.support=c.support;c.canvas=!!document.createElement('canvas').getContext;c.text=!!(c.canvas&&typeof document.createElement('canvas').getContext('2d').fillText=='function');var ele=document.createElement('audio');try{if(c.audio=!!ele.canPlayType){c.ogg=ele.canPlayType('audio/ogg; codecs="vorbis"');c.mp3=ele.canPlayType('audio/mpeg;');c.wav=ele.canPlayType('audio/wav; codecs="1"');c.aac=ele.canPlayType('audio/x-m4a;')||ele.canPlayType('audio/aac;');for(var i in c){if(c[i]=='no'||c[i]==''){c[i]=false;}}}}catch(e){}
try{c.localstorage=!!localStorage.getItem;}catch(e){c.localstorage=false;}
c.worker=!!window.Worker;c.webgl=!!window.WebGLRenderingContext;});re.c('counter').require('font.png').inherit({coins:0,addCoin:function(count){this.coins+=count;this.text='Coins: '+this.coins;}}).init(function(){this.addCoin(0);this.screen=null;this.pos.x=5;this.pos.y=5;});re.c('hero').require('sprite hero.png sprimate pressed physics blowup').namespace({update:function(tick){if(this.dead){this.count+=tick;if(this.count>3){re.scene(re.scene.map,-1);}
return;}
var s=this.speed*tick;if(this.pressed(re.controls.right)){this.vel.x+=s;this.scale.x=1;if(!this.jump)
this.sprimate('run');}else if(this.pressed(re.controls.left)){this.vel.x-=s;this.scale.x=-1;if(!this.jump)
this.sprimate('run');}
if(this.pressed(re.controls.up)&&this.ground&&!this.jump){this.jumpUp();}
if(this.isIdle()){this.sprimate('idle');}
re('tileback').method('parallax',this.pos.x);this.screen.moveTo(this.pos);},step:function(x,y,tx,ty){if(y){this.jump=false;this.ground=(ty>=this.pos.y);if(ty<=this.pos.y){}}}}).define({speed:42,jump:false,ground:false,jumpSpeed:11,size:{x:23,y:24},count:0,power:false,die:function(){if(this.dead)return this;var c=16;if(this.power)c+=18*2;this.blowUp(c);this.dead=true;this.drawing=false;return this;},jumpUp:function(){this.jump=true;this.vel.y-=this.jumpSpeed;this.sprimate('jump');},powerup:function(){var k=function(h){for(var i=0;i<h.length;i++){h[i]+=9;}}
k(this.hero_idle);k(this.hero_run);k(this.hero_jump);k(this.hero_ladder);this.jumpSpeed+=4;this.speed+=6;this.sprimate('jump');this.power=true;return this;}}).init(function(){this.hero_idle=[0,1];this.hero_run=[2,3];this.hero_jump=[4,5,4];this.hero_ladder=[6,7];this.sprimate('idle',0,50,this.hero_idle);this.sprimate('run',0,30,this.hero_run);this.sprimate('jump',1,30,this.hero_jump);this.sprimate('ladder',0,30,this.hero_ladder);this.sprimate('idle');this.fri.y=0.95;this.fri.x=0.75;this.signal('update',this.hero_update);this.signal('step',this.hero_step);}).dispose(function(){this.signal('-update -step');});re.c('particle').require('sprite random physics').init(function(){this.fri.x=0.95;this.fri.y=0.9;this.vel.x=this.random(-14,14);this.vel.y=this.random(-15,-1);this.res.x=0.9;this.res.y=0.9;});re.c('blowup').define({blowUp:function(tile){var s='items.png';if(this.has('hero'))s='hero.png';var width=this.image.width/(re.tile.size.x*0.5);var x=this.pos.x+this.reg.x;var y=this.pos.y+this.reg.y;re.e('particle '+s,4).each(function(i){this.pos.x=x;this.pos.y=y;this.frame.size={x:re.tile.size.x*0.5,y:re.tile.size.y*0.5};this.size=this.frame.size;if(i==0){this.setFrameId(tile);}
if(i==1){this.setFrameId(tile+1);}
if(i==2){this.setFrameId(tile+width);}
if(i==3){this.setFrameId(tile+width+1);}});}});re.c('tileback').require('tilesprite').define({alpha:0.5,parallax:function(x){this.reg.x=x*0.1;}});re.c('tilesprite').require('sprite tile tiles.png').init(function(){this.reg.x=this.size.x*0.5;this.reg.y=this.size.y*0.5;});var canvas='#game';var sounds=[];var dir='';var images=[dir+'tiles.png',dir+'hero.png',dir+'items.png',dir+'font.png',dir+'title.png',dir+'back.png'];var tileSize={x:25,y:25};var backColor='#D6F8FA';var version=1;var current=0;var debug=false;var c='coin';var l='ladder';var b='block';var s='spike';var p='spring';var w='water';var i='win';var l='cloud';var a='apple';var d='acid';re.controls={};re.controls.right=['right','d'];re.controls.left=['left','a'];re.controls.up=['up','w'];re.controls.down=['down','s'];re.scene.preload='preload';re.scene.home='home';re.scene.map='map'
re.scene.credits='credits';re.scene.score='score';re.ready(function(){re.tile.size=tileSize;re.sys.init(canvas).start();re.scene(re.scene.preload);});re.c('acid').require('item').define({cap:'topacid',touch:function(){this.hero.die();},untouch:function(){}}).init(function(){this.setFrameId(16);});re.c('topacid').require('item sprimate').init(function(){this.sprimate('boil',0,40,'17 18 19');this.sprimate('boil');});re.c('apple').require('item sprimate blowup').define({touch:function(t){this.hero.powerup();this.blowUp(4);this.blowUp(4);this.dispose();},untouch:function(t){}}).init(function(){this.setFrameId(1);this.sprimate('idle',0,100,'1 2 3 3 2');this.sprimate('idle');});re.c('block').require('item physics').define({touch:function(){if(this.hero.pos.y<=this.pos.y){this.hero.gra.y=0;this.hero.vel.y=0;this.hero.pos.y=this.pos.y-this.hero.size.y;if(this.hero.pressed(re.controls.up)){this.hero.gra.y=re.physics.gra.y;this.hero.jumpUp();}}else if(this.hero.pos.x<this.pos.x&&this.hero.vel.x>0||this.hero.pos.x>this.pos.x&&this.hero.vel.x<0){this.vel.x+=this.hero.vel.x;this.hero.vel.x=this.forceRes(this.hero.vel.x,0.5);}},untouch:function(){this.hero.gra.y=re.physics.gra.y;}}).init(function(){this.setFrameId(4);});re.c('cloud').require('item').define({touch:function(){},untouch:function(){}}).init(function(){this.signal('!place',function(){re.physics.hitmap.set(this.pos.x/re.tile.size.x,this.pos.y/re.tile.size.y,2);});this.setFrameId(11);});re.c('coin').require('item sprimate blowup').define({touch:function(){re('counter').method('addCoin',1);this.blowUp(48);this.dispose();},untouch:function(){}}).init(function(){this.sprimate('glow',0,40,'14 15 15');this.sprimate('glow');});re.c('item').require('sprite update size items.png').implement('touch untouch').namespace({update:function(t){if(this.hero.touches(this.pos.x,this.pos.y,this.size.x,this.size.y)){this.touching=true;this.touch(t);}else if(this.touching){this.touching=false;this.untouch(t);}}}).inherit({touching:false}).define({place:function(obj){if(typeof obj.xt=='number')
this.pos.x=obj.xt*re.tile.size.x;else
this.pos.x=obj.x;if(typeof obj.yt=='number')
this.pos.y=obj.yt*re.tile.size.y;else
this.pos.y=obj.y;var that=this;if(obj.mul){this.clone(obj.mul-1).each(function(i,t){if(i==t-1&&this.cap){this.comp(this.cap);}
i++;this.pos.x=that.pos.x;this.pos.y=that.pos.y;if(obj.hor)
this.pos.x+=re.tile.size.x*obj.hor*i;if(obj.ver)
this.pos.y+=re.tile.size.y*obj.ver*i;if(this.has('ladder')){re.physics.hitmap.set(this.pos.x/re.tile.size.x,this.pos.y/re.tile.size.y,0);}
this.signal('place');});}
this.signal('place');}}).init(function(c){this.hero=c.hero;this.signal('update',this.item_update);this.updateBefore(this.hero);}).dispose(function(){this.signal('-update',this.item_update);});re.c('ladder').require('item pressed').define({cap:'cap',touch:function(t){this.hero.ground=false;this.hero.jump=false;this.hero.mas.y=0;this.hero.fri.y=0.5;if(this.pressed(re.controls.up)){this.hero.vel.y-=39*t;this.hero.sprimate('ladder');}else if(this.pressed(re.controls.down)){this.hero.vel.y+=39*t;this.hero.sprimate('ladder');}},untouch:function(){this.hero.mas.y=1;this.hero.fri.y=this.old;}}).init(function(){this.old=this.hero.fri.y;this.setFrameId(10);});re.c('cap').require('item').define({touch:function(){},untouch:function(){}}).init(function(){this.setFrameId(0);this.updateBefore(this.hero);});re.c('spike').require('item').define({touch:function(){this.hero.die();},untouch:function(){}}).init(function(){this.setFrameId(5);});re.c('spring').require('item sprimate pressed').define({touch:function(){this.hero.vel.y=-5;if(this.pressed(re.controls.up)){this.hero.vel.y=-15;this.sprimate('bounce');}},untouch:function(){}}).init(function(){this.sprimate('bounce',1,20,'13 12');this.setFrameId(12);});re.c('water').require('item').define({cap:'topwater',fri:{x:0.5,y:0.7},touch:function(){this.hero.alpha=0.5;this.hero.fri=this.fri;},untouch:function(){this.hero.alpha=1;this.hero.fri=this.old;}}).init(function(){this.old=this.hero.fri;this.setFrameId(6);});re.c('topwater').require('item sprimate').init(function(){this.sprimate('boil',0,70,'7 8 9');this.sprimate('boil');});re.c('win').require('item').define({touch:function(){var c=re('counter').get(0);re.scene('score',c.coins,c.max);},untouch:function(){}}).init(function(){this.drawing=false;this.signal('-draw');});re.level=re.c('level').global({levels:[],get:function(index){return this.levels[index];},max:function(){return this.levels.length-1;}}).implement('map spawn hits items back').init(function(c){c.levels.push(this);});re.e('level').define({back:[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,7,7,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,6,5,0,0,0,0,0,0,0,0,7,7,7,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,4,3,0,0,0,7,7,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,5,0,0,0,0,7,7,0,0,0,0],[0,4,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,3,0,0,0,0,0,0,0,0,0,0],[0,4,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,3,0,0,0,0,0,0,0,0,0,0],[0,4,3,0,0,0,0,0,0,0,6,5,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,3,0,0,0,0,0,0,0,0,0,0],[0,1,1,1,0,0,0,0,0,0,4,3,1,0,0,0,0,0,0,0,0,0,0,0,0,1,4,3,0,0,0,0,0,0,0,0,0,0],[0,0,1,1,0,0,0,0,0,0,4,1,1,1,1,0,0,0,1,1,1,0,1,1,0,1,1,1,0,0,0,0,0,0,0,0,0,0],[1,1,1,1,1,1,0,0,0,0,4,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0],[1,1,1,1,1,1,1,0,0,0,4,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]],autoHit:true,map:[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,c,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,c,0,0,7,7,7,0,0,0,0,0,c,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,i],[0,0,0,0,0,0,7,7,7,0,0,0,0,0,0,0,0,7,7,7,0,0,0,0,0,c,0,0,0,0,0,0,c,0,0,0,7,7],[2,2,2,5,0,0,0,0,0,0,0,0,0,6,5,0,0,0,0,0,0,6,5,0,6,2,2,5,0,0,0,0,0,0,7,0,0,0],[1,1,1,3,0,0,0,0,0,0,0,6,2,1,3,s,s,s,s,s,s,4,3,s,1,1,1,3,0,0,0,0,7,0,0,0,0,0],[1,1,1,1,2,2,5,0,0,c,6,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,3,0,0,7,7,0,0,0,0,0,0],[1,1,1,1,1,1,3,0,0,6,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,3,s,s,s,s,s,s,s,s,s,s],[1,1,1,1,1,1,3,s,s,4,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]],spawn:[1,0],hits:[],items:[]});re.e('level').define({back:[],autoHit:true,map:[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,7,0,0,0,0,0,0,i,0,0,0,0],[0,0,0,0,0,0,0,b,0,0,0,0,0,0,0,0,0,0,0,a,0,0,0,0,0,0,7,0,0,0,0,0,0,7,7,7,0,0],[0,0,0,0,0,0,0,7,7,7,0,w,0,0,0,0,l,7,7,7,7,0,0,7,7,0,7,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,7,7,7,0,0,0,0,0,0,0,0,0,0,0,0,0,7,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,7,7,7,0,0,0,0,0,0,0,0,0,7,0,0,0,0,0,0,0,0,7,7,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,7,0,7,0,0,0,7,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,7,0,0,0,0,0,0],[0,0,0,0,6,2,2,5,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[2,2,2,2,1,1,1,1,s,0,0,0,p,6,2,2,5,0,0,0,6,0,0,6,2,2,2,2,0,0,0,0,0,0,0,0,0,0],[1,1,1,1,1,1,1,1,5,s,6,2,2,1,1,1,3,0,0,0,4,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0]],spawn:[1,3],hits:[],items:[['acid',{xt:17,yt:12,mul:2,ver:-1}],['acid',{xt:18,yt:12,mul:2,ver:-1}],['acid',{xt:19,yt:12,mul:2,ver:-1}],['ladder',{xt:15,yt:10,mul:5,ver:-1}]]});re.scene(re.scene.credits).enter(function(){this.by=re.e('font.png').setText('Created by Ben D\'Angelo').centerX();this.by.pos.y=50;this.dem=re.e('font.png').setText('This is a demostration of the Entity engine').centerX();this.dem.pos.y=90;this.che=re.e('font.png').setText('Checkout entityjs.com for more info').centerX();this.che.pos.y=110;this.sp=re.e('font.png keyboard').setText('Press space to return').centerX().centerY(20).signal('keyup:space',function(){re.scene(re.scene.home);});}).exit(function(){current=0;re('font.png').dispose();});re.scene(re.scene.home).enter(function(){this.back=re.e('back.png bitmap position').define('reg',{x:0,y:0}).bottom();this.ver=re.e('font.png').setText('Version '+version).bottom(-5).right(-5);this.by=re.e('font.png').setText('Visit entityjs.com').bottom(-20).right(-4);this.key=re.e('keyboard font.png').signal('keyup:space',function(){re.scene(re.scene.map);}).setText('Press space to start!').centerX().centerY(-20);re('bitfont').method('define','drawing',false);this.title=re.e('title.png bitmap update').define('pos',{x:re.sys.size.x*0.5,y:-10}).signal('update',function(t){this.pos.y+=40*t;if(this.pos.y>=50){this.signal('-update',arguments.callee);this.pos.y=50;re('bitfont').method('define','drawing',true);}});}).exit(function(){re('draw').dispose();});re.scene(re.scene.map).enter(function(level){if(arguments.length==0){level=current++;}
if(level==-1){level=current-1;}
if(debug){level=1;}
var l=re.level.get(level);var m=l.map;var back=l.back;re.physics.hitmap=re.e('hitmap').copy(l.hits);re.physics.hitmap.checkAxisY=function(value,x,y,vx,vy){return value==1||vy>0&&value==2;}
re.physics.gra.y=30;for(var y=0;y<back.length;y++){for(var x=0;x<back[0].length;x++){var n=back[y][x];if(n==0)continue;re.e('tileback').tile(x,y).setFrameId(n-1).frame.size=tileSize;}}
this.hero=re.e('hero').moveTo(re.tile.size.x*l.spawn[0],re.tile.size.y*l.spawn[1]);re.c('item').hero=this.hero;for(y=0;y<m.length;y++){for(x=0;x<m[0].length;x++){n=m[y][x];if(n==0)continue;if(typeof n=='string'){re.e(n).place({xt:x,yt:y});continue;}
re.e('tilesprite').tile(x,y).setFrameId(n-1).frame.size=tileSize;if(l.autoHit){re.physics.hitmap.set(x,y,1);}}}
for(x=0;x<l.items.length;x++){it=l.items[x];re.e(it[0]).place(it[1]);}
re.e('counter').define('max',re('coin').length());var halfx=re.tile.size.x*0.5;var halfy=re.tile.size.y*0.5;re.screen.comp('bind');re.screen.updateAfter(this.hero);re.screen.bind={min:{x:-halfx,y:-halfy},max:{x:m[0].length*re.tile.size.x-re.screen.size.x-halfx,y:re.tile.size.y*m.length-re.screen.size.y-halfy}};this.hero.drawLast();}).exit(function(){re('tilesprite').dispose();re.physics.hitmap.dispose();this.hero.dispose();re('counter').dispose();re('particle').dispose();re('item').dispose();re.screen.pos.x=0;re.screen.pos.y=0;});re.scene('preload').enter(function(){re.sys.clearColor=backColor;re.load.path='/img/demo/';var mar=20;re.e('font').define({text:'http://entityjs.com',pos:{x:re.sys.size.x-110-mar,y:re.sys.size.y-mar}});var b=this.bar=re.e('bar');this.bar.pos.x=mar;this.bar.pos.y=re.sys.size.y-this.bar.size.y-mar;this.bar.topColor='#d44c4f';this.bar.botColor='#ea787b';re.load(sounds.concat(images)).complete(function(){re.screen.reg.x-=tileSize.x*0.5;re.screen.reg.y-=tileSize.y*0.5;re.c('font.png').require('bitfont position').inherit({charWidths:[8,4,8,12,10,12,12,4,6,6,8,8,6,8,4,12,10,6,10,10,10,10,10,10,10,10,4,4,8,8,8,10,12,10,10,8,10,8,8,10,10,8,10,10,8,12,10,10,10,10,10,10,8,10,10,12,10,10,8,6,12,6,8,10,6,10,10,8,10,10,8,10,10,4,6,10,4,12,10,10,10,10,8,10,8,10,10,12,8,10,10,8,4,8],charCache:{}});re.c('tiles.png').init(function(){this.frame={x:0,y:0,size:tileSize};this.reg={x:tileSize.x*0.5,y:tileSize.y*0.5};});re.c('hero.png').init(function(){this.frame={x:0,y:0,size:tileSize};this.reg.x=this.frame.size.x*0.5;this.reg.y=this.frame.size.y*0.5;});re.c('items.png').init(function(){this.frame={x:0,y:0,size:tileSize};this.reg={x:tileSize.x*0.5,y:tileSize.y*0.5};this.size={x:tileSize.x,y:tileSize.y};});if(!debug)re.scene(re.scene.home);else re.scene(re.scene.map);}).progress(function(c,t){b.size.x=(c/t)*b.size.max.x;}).error(function(a){console.log('Error loading asset '+a);});}).exit(function(){re('draw').dispose();});re.scene(re.scene.score).enter(function(coins,maxCoins){re.e('back.png bitmap position').define('reg',{x:0,y:0}).bottom();re.e('font.png').setText('Level '+current+' Completed!').centerX().centerY(-60);re.e('font.png').setText('Coins Collected: '+coins+' / '+maxCoins).centerX().centerY();re.e('font.png keyboard').setText('Press space to continue').centerX().signal('keyup:space',function(){if(current>re.level.max()){re.scene(re.scene.credits);}else{re.scene(re.scene.map);}}).pos.y=re.sys.size.y-50;}).exit(function(){re('draw').dispose();});