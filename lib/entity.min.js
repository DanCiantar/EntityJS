/* EntityJS v0.1 http://entityjs.com | License http://entityjs.com/license */
entity=re=function(selector){return new re.query(selector);}
re.version="0.1";re._e=[];re._c={};re.ready=function(r){window.onload=r;}
re.$=function(s){if(s.charAt(0)=='#'){return document.getElementById(s.substr(1));}
return document.getElementsByTagName(s);}(function(re){comp=function(title){if(!this._c[title]){this._c[title]=new re.comp.init(title);}
return this._c[title];}
c=function(name){this.name=name;this._re_defaults={};this._re_defines={};this._re_signals={};}
var p=c.prototype;p.name='';p._re_final=false;p._re_requires='';p._checkFinal=function(){if(this._re_final){throw this.name+' is final.';}}
p.static=function(obj,value){this._checkFinal();if(typeof obj=='object'){for(var type in obj){this[type]=obj[type];}}else{this[obj]=value;}
return this;}
p.require=function(requirements){this._checkFinal();this._re_requires+=requirements+' ';return this;}
p.assert=function(asserts){this._re_asserts=asserts.split(' ');return this;}
p.signal=function(string,method){return re.entity.init.prototype.signal.call(this,string,method);}
p.default=function(d,value){this._checkFinal();if(typeof d=='object'){for(var k in d){this._re_defaults[k]=d[k];}}else{this._re_defaults[d]=value;}
return this;}
p.run=function(method){this._checkFinal();method.call(this);return this;}
p.define=function(d,value){this._checkFinal();if(typeof d=='object'){for(var k in d){this._re_defines[k]=d[k];}}else{this._re_defines[d]=value;}
return this;}
p.init=function(method){this._checkFinal();this._re_init=method;return this;}
p.dispose=function(method){this._checkFinal();this._re_dispose=method;return this;}
p.alias=function(s){this._checkFinal();var p=s.split(' ');if(p.length>1){for(var i in p){this.alias(p[i]);}
return this;}
if(s.charAt(0)=='-'){var t=re._c[s.substr(1)];if(t==this){delete t;return t;}}else{re._c[s]=this;}
return this;}
p.final=function(){this._checkFinal();this._re_final=true;return this;}
p.interface=function(i){this._checkFinal();if(this._re_interface){this._re_interface+=' '+i;}else{this._re_interface=i;}
return this;}
p.namespace=function(obj,value){this._checkFinal();var name=this.name+'_';if(typeof obj=='object'){for(var k in obj){this._re_defines[name+k]=obj[k];}}else{this._re_defines[name+obj]=value;}
return this;}
re.comp=re.c=comp;re.comp.init=c;}(re));(function(re){en=function(c,count){if(arguments.length==1){return new re.entity.init(c);}
var q=re();for(var i=0;i<count;i++){q._e.push(re.e(c));}
return q;}
en.id=0;e=function(c){c=c||'';this._re_comps=[];this._re_signals={};en.id++;this.id=en.id+'';re._e.push(this);this.comp(c);}
var p=e.prototype;p.id='';p.comps=function(){var r='';for(var k in this._re_comps){r+=' '+this._re_comps[k];}
return r.substr(1);}
p.comp=function(com){this._re_comp(com);if(this._re_interface){for(var i in this){if(!this.hasOwnProperty(i)){throw'Interface error: missing '+i;}}}
return this;}
p._re_comp=function(com){if(!com||com==''||com==' ')return this;var pieces=com.split(' ');if(pieces.length>1){for(var k in pieces){this._re_comp(pieces[k]);}
return this;}
var c;if(com.charAt(0)=='-'){com=com.substr(1);c=re._c[com];if(!this.has(com))return this;this._re_comps.splice(this._re_comps.indexOf(com),1);if(c){if(c._re_dispose){c._re_dispose.call(this,c);}
c.signal('dispose');}}else{var vals=com.split(':');com=vals[0];c=re._c[com];vals[0]=c;if(this.has(com))return this;this._re_comps.push(com);if(c){this._re_comp(c._re_requires);if(c._re_interface){if(this._re_interface){this._re_interface=[];}
this._re_interface.concat(c._re_interface.split(' '));}
if(c._re_asserts){for(var t in c._re_asserts){if(this._re_comps.indexOf(c._re_asserts[t])!=-1){throw'Assert: '+c.name+' cannot be coupled with '+c._re_asserts[t];}}}
if(c._re_defaults){this.default(c._re_defaults);}
if(c._re_defines){this.define(c._re_defines);}
if(c._re_init){c._re_init.apply(this,vals);}
c.signal('init',this);}}
return this;}
p.length=function(){return this._re_comps.length;}
p.clone=function(){Clone.prototype=this;return new Clone();}
function Clone(){}
p.has=function(comp){if(typeof comp=='string'){comp=re.query._toObj(comp);}
comp.comp=comp.comp||[];comp.id=comp.id||'';comp.signal=comp.signal||[];comp.not=comp.not||[];for(p=0;p<comp.comp.length;p++){if(this._re_comps.indexOf(comp.comp[p])==-1){return false;}}
for(p=0;p<comp.not.length;p++){if(this._re_comps.indexOf(comp.not[p])!=-1){return false;}}
var s;for(p=0;p<comp.signal.length;p++){s=comp.signal[p];if(!this._re_signals[s]||this._re_signals[s].length==0){return false;}}
if(comp.id!=''&&this.id!=comp.id){return false;}
return true;}
p.signal=function(type,method){if(arguments.length==0||type==undefined){throw'Signal error Type variable undefined';}
if(arguments.length==1){method=null;}
var c;if(typeof type=='string'){c=type.split(' ');if(c.length>1){var args=Array.prototype.slice.call(arguments,1);for(var k in c){args.unshift(c[k]);this.signal.apply(this,args);args.shift();}
return this;}}
if(typeof type=='object'){for(var k in type){this.signal(k,type[k]);}}else if(type.charAt(0)=='-'){type=type.substr(1);if(type=='*'){this._re_signals={};}else if(method&&typeof method=='function'){for(var k in this._re_signals[type]){if(this._re_signals[type][k].f==method){this._re_signals[type].splice(k,1);}}}else{while(this._re_signals[type]&&this._re_signals[type].length!=0){this._re_signals[type].pop();}}}else if(arguments.length==2&&method&&typeof method=='function'){var obj={f:method};if(type.charAt(0)=='!'){obj.once=true;type=type.substr(1);}
if(!this._re_signals[type]){this._re_signals[type]=[];}
this._re_signals[type].push(obj);}else{if(!this._re_signals[type]){return this;}
var b;for(var i=0;i<this._re_signals[type].length;i++){b=this._re_signals[type];b[i].f.apply(this,arguments);if(b.once){b.splice(i,1);}
if(type!='*'&&this._re_signals['*']){this.signal('*');}}}
return this;}
p.define=function(obj,value){if(typeof obj=='object'){for(var key in obj){this[key]=obj[key];}}else{this[obj]=value;}
return this;}
p.default=function(obj,value){if(typeof obj=='object'){for(var key in obj){if(!this.hasOwnProperty(key)){this[key]=obj[key];}}}else{if(!this.hasOwnProperty(obj)){this[obj]=value;}}
return this;}
p.dispose=function(){re._e.splice(re._e.indexOf(this),1);for(var i in this._re_comps){var k=re.c(this._re_comps[i]);if(k._re_dispose){k._re_dispose.call(this,k);}}
this.signal('dispose');return this;}
re.entity=re.e=en;re.entity.init=e;}(re));(function(re){var b=function(assets){return new re.load.init(assets);}
b.path="";b.maxChannels=3;b.supportedImages=['gif','jpg','jpeg','png'];b.supportedSounds=['wav','mp3','aac','ogg','m4a'];var l=function(assets){if(typeof assets=='string'){this.assets=assets.split(' ');}
var a;for(var i in this.assets){this.total++;a=this.assets[i];var ext=a.substr(a.lastIndexOf('.')+1).toLowerCase();if(re.load.supportedImages.indexOf(ext)!=-1){this._loadImg(a);}else if(re.support(ext)&&re.load.supportedSounds.indexOf(ext)!=-1){this._loadSound(a);}}
return this;}
var p=l.prototype;p.current=0;p.total=0;p._loadImg=function(a){var that=this;var img=new Image();re.c(a).static({image:img}).define({image:img});img.onload=function(){that.current++;if(that._p){that._p.call(that,that.current,that.total,a);}
if(that.current>=that.total){if(that._s){that._s.call(that,that.assets);}}}
img.onerror=function(){if(that._e){that._e.call(that,a);}}
img.src=re.load.path+a
return this;}
p._loadSound=function(a){var that=this;var channels=[];var a=new Audio(re.load.path+a);a.load();document.body.appendChild(a);a.addEventListener('canplaythrough',function(e){for(var i=0;i<re.load.maxChannels-1;i++){channels.push(a.cloneNode(true));}
that.current++;if(that._p){that._p.call(that,that.current,that.total,a);}
if(that.current>=that.total){if(that._s){that._s.call(that,that.assets);}}},false);re.c(a).static(function(){channels:channels}).define({channels:channels});}
p.progress=function(m){this._p=m;return this;}
p.success=function(m){this._s=m;return this;}
p.error=function(m){this._e=m;return this;}
re.load=b;re.load.init=l;}(re));(function(re){q=function(selector){this._e=[];if(selector){this.query(selector);}}
q._toObj=function(query){var temp=query.split(' ');var comps=[];var signals=[];var minus=[];var id='';var fl;var val;for(var j=0;j<temp.length;j++){fl=temp[j].charAt(0);val=temp[j].substr(1);if(fl=='^'){signals.push(val);}else if(fl=='-'){minus.push(val);}else if(fl=='#'){id=val;}else{comps.push(temp[j]);}}
var comp={comp:comps,signal:signals,not:minus,id:id};return comp;}
p=q.prototype;p.query=function(select){select=select||'';var i=0;if(typeof select=='string'){if(select=='*'){this._e=re._e.slice();return this;}
var obj=re.query._toObj(select);var en;main:for(;i<re._e.length;i++){en=re._e[i];if(en.has(obj)){this._e.push(en);}}}else if(typeof select=='function'){for(;i<re._e.length;i++){if(select(re._e[i],i)){this._e.push(re._e[i]);}}}
return this;}
p.toArray=function(){return this._e.slice();}
p.method=function(m){this.each(function(){this[m].call(this);});}
p.each=function(method){var l=this._e.length;for(var i=0;i<l;i++){method.call(this._e[i],i,l);}
return this;}
p.map=function(w,method){var x=0;var y=0;for(var i=0;i<this._e.length;i++){method.call(this._e[i],x,y);x++;if(x==w){x=0;y++;}}}
p.comps=function(){var l='';this.each(function(){l+=' '+this.comps();});return l.substr(1);}
p.random=function(){return this._e[Math.random()*this._e.length];}
p.pluck=function(value){var t=[];var k=value.split(' ');this.each(function(){var o={};for(var p in k){o[k[p]]=this[k[p]];}
t.push(o);});return t;}
p.define=function(obj,value){this.each(function(){this.define(obj,value);});return this;}
p.default=function(obj,value){this.each(function(){this.default(obj,value);});return this;}
p.comp=function(components){this.each(function(ref){this.comp(components);});return this;}
p.signal=function(type,method){var p=arguments;this.each(function(ref){this.signal.apply(this,p);});return this;}
p.length=function(){return this._e.length;}
p.filter=function(method){var q=re();var that=this;this.each(function(i){if(method.call(this,i)){q.push(this);}});return q;}
p.has=function(comp){for(var i=0;i<this._e.length;i++){if(!this._e.has(comp)){return false;}}
return this;}
p.dispose=function(){this.each(function(){this.dispose();});return this;}
p.get=function(index){return this._e[index];}
p.put=function(entity){this._e.push(entity);return this;}
re.query=q;}(re));re.system=re.sys=re.c('system').static({size:{x:0,y:0},clearColor:'#f9f9f9',running:false,clear:function(color){re.system.context.fillStyle=color;re.system.context.fillRect(0,0,re.system.size.x,re.system.size.y);return this;},start:function(){if(!re.system.running){re.system.running=true;re.sys.inter=re.e('interval').start(re.sys.fps,re.sys._d);}
return this;},delegate:function(m){re.sys._d=m;return this;},_d:function(){re.system.clear(re.system.clearColor);re.c('update').update();re.c('draw').draw(re.system.context);},stop:function(){if(re.sys.running){re.system.running=false;re.sys.inter.stop();}
return this;},init:function(canvasId,fps){this.canvas=re.$(canvasId);this.context=this.canvas.getContext('2d');this.size.x=this.canvas.width;this.size.y=this.canvas.height;if(arguments.length>=2){re.system.fps=fps;}
return this;}});re.c('draw').static({listeners:[],draw:function(context){var that=re.c('draw');for(var k in that.listeners){if(that.listeners[k].visible){that.listeners[k].signal('draw',context);}}}}).init(function(c){c.listeners.push(this);}).dispose(function(c){c.listeners.splice(c.listeners.indexOf(this),1);}).define({visible:true,infront:function(en){var l=re.c('draw').listeners;var him=l.indexOf(en);var me=l.indexOf(this);if(him>me){var t=l[him];l[him]=l[me];l[me]=t;}
return this;},inback:function(en){var l=re.c('draw').listeners;var him=l.indexOf(en);var me=l.indexOf(this);if(him<me){var t=l[him];l[him]=l[me];l[me]=t;}
return this;}});re.comp('interval').default({ticks:0,paused:false,_intervalId:null,interval:50,fps:0,_onTick:null,start:function(fps,onTick){if(arguments.length==1){this.interval=1000/fps;this.fps=1000/this.interval;}
paused=false;if(arguments.length==2){this._onTick=onTick;}
var that=this;this._intervalId=setInterval(function(){that.ticks++;that._onTick.call(that,that.ticks);},this.interval);},stop:function(){if(this._intervalId)clearInterval(this._intervalId);paused=true;}});re.c('sprimate').require('sprite update').namespace({frame:0,animating:'',reels:null,old:null,reel:null,tick:0,loops:0,stop:function(){if(this.animating()){this.sprimate_animating='';this.signal('animated');this.define('frame',{x:this.sprimate_old.x,y:this.sprimate_old.y});this.signal('-update',this.sprimate_frame);}
return this;},frame:function(){var c=this.sprimate_reel;if(this.sprimate_tick++==c.duration){this.sprimate_tick=0;if(this.sprimate_frame==this.sprimate_reel.frames.length){if(c.loops==0||--this.sprimate_loops>=1){this.sprimate_frame=0;}else{this.sprimate_stop();}
return;}
this.frameId(c.frames[this.sprimate_frame]);this.sprimate_frame++;}}}).init(function(){this.sprimate_reels={};this.sprimate_old={};this.sprimate_currentReel={};}).define({sprimate:function(id,loops,duration,frames){id=id||'';if(arguments.length==0){this.sprimate_stop();}
if(!this.sprimate_reels[id]){this.sprimate_reels[id]={frames:frames,duration:duration,loops:loops};}else{if(!this.sprimate_reels[id]){return this;}
if(this.animating()){this.signal('-update',this.sprimate_frame);}
this.sprimate_animating=id;var r=this.sprimate_reels[id];var c=this.sprimate_reel;c.loops=(isNaN(loops))?r.loops:loops;c.duration=(isNaN(duration))?r.duration:duration;c.frames=(typeof frames=='array')?frames:r.frames;this.sprimate_loops=c.loops;c.duration=parseInt((c.duration)/(c.frames.length));this.sprimate_old.x=this.frame.x;this.sprimate_old.y=this.frame.y;this.sprimate_frame=0;this.sprimate_tick=0;this.sprimate_frame();this.signal('update',this.sprimate_frame);}
return this;},animating:function(id){if(id){return this.sprimate_animating==id;}
return this.sprimate_animating!='';}});re.comp('tick').default({ticks:0,paused:false,_intervalId:null,_interval:50,_onTick:null,start:function(onTick){paused=false;if(onTick){this._onTick=onTick;}
var that=this;this._intervalId=setInterval(function(){that.ticks++;that._onTick.call(that);},this._interval);},stop:function(){if(this._intervalId)clearInterval(this._intervalId);paused=true;},fps:function(value){if(value){this._interval=1000/value;return this;}
return 1000/this._interval;}});re.c('update').static({listeners:[],ticks:0,update:function(){var that=re.c('update');for(var k in that.listeners){that.listeners[k].signal('update',that.ticks);}
that.ticks++;}}).define({_active:true,active:function(value){if(arguments.length){this._active=value;return this;}
return this._active;}}).init(function(){re.c('update').listeners.push(this);}).dispose(function(){re.c('update').listeners.splice(re.c('update').listeners.indexOf(this),1);});re.c('worker').init(function(){throw'Not implemented';});re.comp('bitmap').require('point draw -sprite').init(function(){this.signal('draw',this.draw);}).dispose(function(){this.signal('-draw',this.draw);}).default({image:null}).define({draw:function(t,context){if(this.image){var x=this.pos.x;var y=this.pos.y;if(this.group){x+=this.group.pos.x;y+=this.group.pos.y;}
context.drawImage(this.image,x,y,this.image.width,this.image.height);}}});re.c('particle');re.c('shape').require('point draw').define({});re.c('sprite').require('point draw idgrid -bitmap').init(function(){this.frame={x:0,y:0};this.frame.size={x:0,y:0};this.signal('draw',this.draw);}).dispose(function(){this.signal('-draw',this.draw);}).define({setFrameId:function(id){this.frame.x=this.idToXt(id,this.image.width,this.frame.size.x);this.frame.y=this.idToYt(id,this.image.width,this.frame.size.y);},getFrameId:function(){return this.toId(this.frame.y,this.frame.x,this.image.width);},draw:function(t,context){if(this.image){var x=this.pos.x;var y=this.pos.y;if(this.group){x+=this.group.pos.x;y+=this.group.pos.y;}
context.drawImage(this.image,this.frame.x*this.frame.size.x,this.frame.y*this.frame.size.y,this.frame.size.x,this.frame.size.y,x,y,this.frame.size.x,this.frame.size.y);}
return this;}});re.c('text').require('draw point').define({font:"14px sans-serif",textColor:'#000000',textAlign:'',text:'',draw:function(t,context){if(this.text!=''){context.font=this.font;context.fillStyle=this.textColor;context.fillText(this.text,this.pos.x,this.pos.y);}}}).init(function(){this.signal('draw',this.draw);}).dispose(function(){this.signal('-draw',this.draw);});re.keyboard=re.c('keyboard').static({listeners:[],keyCodes:{65:'a',66:'b',67:'c',68:'d',69:'e',70:'f',71:'g',72:'h',73:'i',74:'j',75:'k',76:'l',77:'m',78:'n',79:'o',80:'p',81:'q',82:'r',83:'s',84:'t',85:'u',86:'v',87:'w',88:'x',89:'y',90:'z',48:'0',49:'1',50:'2',51:'3',52:'4',53:'5',54:'6',55:'7',56:'8',57:'9',112:'f1',113:'f2',114:'f3',115:'f4',116:'f5',117:'f6',118:'f7',119:'f8',120:'f9',121:'f10',122:'f11',123:'f12',16:'shift',17:'ctrl',18:'alt',24:'cmd',255:'fn',8:'backspace',13:'enter',32:'space',27:'esc',9:'tab',20:'capslock',91:'windows',45:'insert',46:'delete',36:'home',35:'end',33:'pageup',34:'pagedown',37:'left',38:'up',39:'right',40:'down',96:'`',45:'-',187:'=',219:'[',221:']',220:'\\',59:';',222:"'",188:',',190:'.',191:'/'},keyboardEvent:function(e){var that=re.c('keyboard');e.keyCode=e.keyCode||e.which;var key=that.keyCodes[e.keyCode];if(re.c('pressed').preventDefault[key]){e.preventDefault();}
if(re.c('pressed')._pressed){re.c('pressed')._pressed[key]=(e.type=='keydown');}
for(var k in that.listeners){that.listeners[k].signal(e.type,key);that.listeners[k].signal(e.type+':'+key);}}}).run(function(){document.addEventListener('keydown',this.keyboardEvent,false);document.addEventListener('keyup',this.keyboardEvent,false);}).init(function(c){c.listeners.push(this);}).dispose(function(c){c.listeners.splice(c.listeners.indexOf(this),1);});re.c('mouse').static({listeners:[],mouseAction:function(e){var button;if(e.which==null){if(e.button<2){button='left';}else if(e.button==4){button='middle';}else{button='right';}}else{if(e.which<2){button='left';}else if(e.which==2){button='middle';}else{button='right';}}
button='mouse'+button;if(re.c('pressed')._pressed){re.c('pressed')._pressed[button]=(e.type=='mousedown');}
if(re.c('pressed').preventDefault){if(re.c('pressed').preventDefault[button]){e.preventDefault();}}
re.c('mouse').mouseEvent(e);},mouseEvent:function(e){var x;var y;if(e.pageX||e.pageY){x=e.pageX;y=e.pageY;}else{x=e.clientX+document.body.scrollLeft+document.documentElement.scrollLeft;y=e.clientY+document.body.scrollTop+document.documentElement.scrollTop;}
if(re.system.canvas){x-=re.system.canvas.offsetLeft;y-=re.system.canvas.offsetTop;}
if(x<0||y<0||y>re.system.size.y||x>re.system.size.x){return;}
var that=re.c('mouse');for(var i in that.listeners){that.listeners[i].signal(e.type,x,y,e);}}}).run(function(){var targ=window.addEventListener?window:document;targ.addEventListener('mousedown',this.mouseAction,false);targ.addEventListener('mouseup',this.mouseAction,false);targ.addEventListener('mousemove',this.mouseEvent,false);targ.addEventListener('click',this.mouseEvent,false);targ.addEventListener('dblclick',this.mouseEvent,false);targ.addEventListener('contextmenu',this.mouseEvent,false);}).init(function(c){c.listeners.push(this);}).dispose(function(c){c.listeners.splice(c.listeners.indexOf(this),1);})re.c('pressed').static({_pressed:{},preventDefault:{}}).define({pressed:function(key){var that=re.c('pressed');if(arguments.length>1){for(var i=0;i<arguments.length;i++){if(that._pressed[arguments[i]]){return true;}}}
return that._pressed[key];},preventDefault:function(key){var p=key.split(' ');if(p.length>1){for(var k in p){this.preventDefault(p[k]);}
return this;}
re.c('pressed').preventDefault[key]=true;return this;},});re.c('bounds').require('point update').init(function(){this.bounds={min:{x:0,y:0},max:{x:10,y:10}};this.signal('update',function(){if(this.pos.x>this.bounds.min.x){this.pos.x=this.bounds.min.x;}
if(this.pos.y>this.bounds.min.y){this.pos.y=this.bounds.min.y;}
if(this.pos.x<-this.bounds.max.x+re.sys.size.x){this.pos.x=-this.bounds.max.x+re.sys.size.x;}
if(this.pos.y<-this.bounds.max.y+re.sys.size.y){this.pos.y=-this.bounds.max.y+re.sys.size.y;}});});re.c('drag').require('point').namespace({pos:null,}).init(function(){this.drag_pos={x:0,y:0};}).define({anchorDrag:function(x,y){this.drag_pos.x=x;this.drag_pos.y=y;},updateDrag:function(x,y){this.pos.x+=x-this.drag_pos.x;this.pos.y+=y-this.drag_pos.y;this.drag_pos.x=x;this.drag_pos.y=y;}});re.c('group').require('point').define({group:null,groupX:function(){var x=this.pos.x;if(this.group){x+=this.group.pos.x;}
return x;},groupY:function(){var y=this.pos.y;if(this.group){y+=this.group.pos.y;}
return y;}});re.c('idgrid').define({idToX:function(id,width,size){return this.idToXt(id,width)*size;},idToY:function(id,width,size){return this.idToYt(id,width)*size;},idToXt:function(id,width,size){return Math.floor(id%(width/size));},idToYt:function(id,width,size){return Math.floor((id*size)/(width+0.1));},toId:function(xt,yt,wt){return xt+(yt*wt);}});re.physics=re.c('physics').require('point update').static({defaultHitmap:null,gravity:{x:0,y:0},MOVEMENT:'movement'}).init(function(c){if(!this.has('size')||!this.has('radius')){this.comp('size');}
this.vel={x:0,y:0};this.fri={x:0.5,y:0.5};this.acc={x:0,y:0};this.maxVel={x:10,y:10};this.res={x:0,y:0};this.mas={x:1,y:1};this.signal('update',this.update);this.hitmap=c.defaultHitmap;}).dispose(function(){this.signal('-update',this.update);}).default({hitmap:null,vel:null,fri:null,acc:null,maxVel:null,res:null,mas:null,update:function(){this.vel.x=this.calculateVel(this.vel.x,this.acc.x,this.fri.x,this.maxVel.x,re.physics.gravity.x,this.mas.x);this.vel.y=this.calculateVel(this.vel.y,this.acc.y,this.fri.y,this.maxVel.y,re.physics.gravity.y,this.mas.y);this.movement(this.hitmap.checkHit(this.pos.x,this.pos.y,this.vel.x,this.vel.y,this.size.x,this.size.y));},movement:function(result){if(result.hit.x){this.vel.x=-this.vel.x*this.res.x;}
if(result.hit.y){this.vel.y=-this.vel.y*this.res.y;}
this.pos=result.pos;this.signal(re.physics.MOVEMENT,result);},calculateVel:function(vel,acc,fri,max,gra,mas){var v=(vel+acc)*fri+gra*mas;v.limit(-max,max);return v;}});re.comp('point').init(function(){this.pos={x:0,y:0};}).default({distanceTo:function(x,y){}});re.c('radius').require('point -size').define({radius:0,touches:function(targ){},distanceTo:function(xt,yt){}});re.c('size').require('point -radius').define({leftEdge:function(){return this.pos.x;},rightEdge:function(){return this.pos.x+this.size.x;},bottomEdge:function(){return this.pos.y+this.size.y;},topEdge:function(){return this.pos.y;},centerX:function(){return(this.pos.x+this.size.x)/2;},centerY:function(){return(this.pos.y+this.size.y)/2;},touches:function(targ){return!(targ.pos.x>this.pos.x+this.size.x||targ.pos.x+targ.size.x<this.pos.x||targ.pos.y>this.pos.y+this.size.y||targ.pos.y+targ.size.y<this.pos.y);},distanceTo:function(xt,yt){if(typeof xt=='object'){if(xt.has('size')){yt=(xt.pos.y+xt.size.y)/2;xt=(xt.pos.x+xt.size.x)/2;}else{yt=xt.pos.y;xt=xt.pos.x;}}
var kx,ky;kx=xt-this.pos.x>>31;ky=yt-this.pos.y>>31;return Math.round(((xt-this.pos.x^kx)-kx)+((yt-this.pos.y^ky)-ky));}}).init(function(){this.size={x:0,y:0};})
re.tile=re.c('tile').require('point size').static({size:{x:40,y:40},pointToX:function(x){return re.tile.pointToXt(x)*re.tile.size.x;},pointToY:function(y){return re.tile.pointToYt(y)*re.tile.size.y;},pointToXt:function(x){return Math.round((x-re.tile.size.x*0.5)/re.tile.size.x);},pointToYt:function(y){return Math.round((y-re.tile.size.y*0.5)/re.tile.size.y);}}).init(function(){this.size=re.tile.size;}).define({tileFromPoint:function(x,y){this.pos.x=re.tile.pointToX(x);this.pos.y=re.tile.pointToY(y);},tile:function(xt,yt){this.setXt(xt);this.setYt(yt);return this;},setXt:function(value){this.pos.x=Math.floor(value*this.size.x);return this;},getXt:function(){return Math.floor(this.pos.x/this.size.x);},setYt:function(value){this.pos.y=Math.floor(value*this.size.y);return this;},getYt:function(){return Math.floor(this.pos.y/this.size.y);}});re.sound=re.c('sound').static({enabled:true,volume:1}).init(function(){throw'not implemeneted';}).default({volume:1}).define({play:function(loop){},stop:function(){}});re.c('socket').init(function(){throw'Not implemeneted';});re.c('map').define({value:0,map:null,size:null,add:function(x,y,value){if(arguments.length==3){while(y>=this.map.length){var m=new Array(this.map[0]);for(var l in m){m[l]=this.value;}
this.map.push(m);}
while(x>=this.map[this.map.length-1].length){for(var k=0;k<this.map.length;k++){this.map[k].push(this.value);}}
this.size.x=this.map[y].length;this.size.y=this.map.length;this.map[y][x]=value;return this;}
return this.map[y][x];},within:function(x,y){if(y<0||y>=this.size.y||x<0||x>=this.size.x){return false;}
return true;},get:function(x,y){if(this.within(x,y)){return this.map[y][x];}
return null;}}).init(function(){this.size={x:0,y:0};this.map=[];});re.c('database').init(function(){throw'Database component not implemented.';});re.c('storage').init(function(c,type){throw'Storage not implemented!';});re.c('scene').static({_scenes:{},current:'',scene:function(title){var s=re.c('scene');var k=title.split(' ');if(k.length>1){title=k.pop();for(var b in k){re.c('scene').scene.apply(s,arguments);}}
if(title.charAt(0)=='-'){var t=s._scenes[title.substr(1)];delete s._scenes[title.substr(1)];return t;}else if(s._scenes[title]){var t=s._scenes[s.current];if(s.current!=''&&typeof t.scene_exit=='function'){t.scene_exit.call(t,title);}
s.current=title;t=s._scenes[title];if(typeof t.scene_enter=='function'){t.scene_enter.apply(t,Array.prototype.slice.call(arguments,1));}}else{re.e('scene:'+title);}
return s._scenes[title];}}).init(function(c,title){c._scenes[title]=this;this.sceneName=title;}).dispose(function(c){delete c._scenes[this.sceneName];}).define({enter:function(m){this.scene_enter=m;return this;},exit:function(m){this.scene_exit=m;return this;},scene:function(title){return re.c('scene').apply(this,arguments);}});re.scene=re.c('scene').scene;re.c('sheet').require('tile').define({sheet:function(map,padX,padY){var frameWidth=re.tile.size.x;var frameHeight=re.tile.size.y;if(padX){frameWidth+=padX;}
if(padY){frameHeight+=padY;}
var x;var y;for(var p in map){x=map[p][0]||0;y=map[p][1]||0;re.c(p).require('sprite').define({frame:{x:x,y:y,size:{x:frameWidth,y:frameHeight}},sheet:this.image,});}
return this;}});re.c('support').static({support:function(s){var that=re.c('support');if(arguments.length>1){var d;for(var i=0;i<arguments.length;i++){d=arguments[i];if(that.support(d)){return d;}}
return false;}
var k=s.split(' ');var stat=true;for(var j in k){stat=stat&&!!that[k[j]];}
return stat;}}).define({support:function(s){return re.c('support').call(this,s);}}).run(function(){var c=re.c('support');re.support=c.support;c.canvas=!!document.createElement('canvas').getContext;c.text=!!(c.canvas&&typeof document.createElement('canvas').getContext('2d').fillText=='function');var ele=document.createElement('audio');try{if(c.audio=!!ele.canPlayType){c.ogg=ele.canPlayType('audio/ogg; codecs="vorbis"');c.mp3=ele.canPlayType('audio/mpeg;');c.wav=ele.canPlayType('audio/wav; codecs="1"');c.aac=c.m4a=ele.canPlayType('audio/x-m4a;')||elem.canPlayType('audio/aac;');for(var i in c){if(c[i]=='no'){c[i]=false;}}}}catch(e){}
try{c.localstorage=!!localStorage.getItem;}catch(e){c.localstorage=false;}
c.worker=!!window.Worker;c.webgl=!!window.WebGLRenderingContext;});